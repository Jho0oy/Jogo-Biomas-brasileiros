const DATA={biomes:[{id:'amazonia',name:'Amazônia',desc:'Maior floresta tropical do mundo.'},{id:'cerrado',name:'Cerrado',desc:'Savanas brasileiras ricas em biodiversidade.'},{id:'caatinga',name:'Caatinga',desc:'Bioma semiárido com espécies adaptadas à seca.'},{id:'pantanal',name:'Pantanal',desc:'Maior planície alagável do planeta.'},{id:'mata',name:'Mata Atlântica',desc:'Bioma costeiro muito ameaçado.'},{id:'pampa',name:'Pampa',desc:'Campos do sul com rica fauna e flora.'}],problems:[{id:'queimadas',name:'Queimadas',desc:'Fogo destrói habitats e libera CO₂.'},{id:'desmatamento',name:'Desmatamento',desc:'Remoção da vegetação nativa.'},{id:'poluicao',name:'Poluição',desc:'Contaminação do solo e água.'},{id:'extincao',name:'Extinção',desc:'Perda de espécies por caça e degradação.'}],ods:[{id:4,title:'ODS 4 - Educação de qualidade',desc:'Educação ambiental e conscientização.',points:30},{id:13,title:'ODS 13 - Ação climática',desc:'Combate às mudanças climáticas.',points:40},{id:15,title:'ODS 15 - Vida terrestre',desc:'Proteção de ecossistemas.',points:35},{id:6,title:'ODS 6 - Água potável e saneamento',desc:'Preservação de recursos hídricos.',points:20}]};let state={remaining:[],total:0,current:{},rounds:[]};const $=s=>document.querySelector(s);const screens={start:$('#start-screen'),biome:$('#biome-screen'),problem:$('#problem-screen'),ods:$('#ods-screen'),result:$('#result-screen'),final:$('#final-screen')};function show(n){Object.values(screens).forEach(s=>s.classList.remove('active'));screens[n].classList.add('active');}let ctx;function beep(f=440,t=0.05){if(!window.AudioContext)return;if(!ctx)ctx=new AudioContext();const o=ctx.createOscillator(),g=ctx.createGain();o.frequency.value=f;g.gain.value=0.02;o.connect(g);g.connect(ctx.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+t);o.stop(ctx.currentTime+t+0.01);}function init(){state.remaining=DATA.biomes.map(b=>b.id);state.total=0;state.rounds=[];renderMap();updateProgress(0);show('biome');}function renderMap(){const m=$('#biome-map');m.querySelectorAll('.biome-point').forEach(b=>{const id=b.dataset.id;b.disabled=!state.remaining.includes(id);b.onclick=()=>moveRocketTo(id);});}function moveRocketTo(id){const b=document.querySelector(`.biome-point[data-id='${id}']`);const r=$('#rocket');const rm=b.parentElement.getBoundingClientRect();const rb=b.getBoundingClientRect();const top=rb.top-rm.top+b.offsetHeight/2;const left=rb.left-rm.left+b.offsetWidth/2;r.style.top=`${top}px`;r.style.left=`${left}px`;r.style.transform='translate(-50%,-50%) rotate(20deg)';beep(660,0.08);setTimeout(()=>selectBiome(id),1000);}function selectBiome(id){const b=DATA.biomes.find(x=>x.id===id);state.current.biome=b;$('#biome-title').textContent=b.name;$('#biome-desc').textContent=b.desc;const l=$('#problem-list');l.innerHTML='';DATA.problems.forEach(p=>{const d=document.createElement('div');d.className='option';d.innerHTML=`<strong>${p.name}</strong><br><small>${p.desc}</small>`;d.onclick=()=>selectProblem(p.id);l.appendChild(d);});show('problem');}function selectProblem(id){const p=DATA.problems.find(x=>x.id===id);state.current.problem=p;$('#problem-title').textContent=p.name;$('#problem-desc').textContent=p.desc;const l=$('#ods-list');l.innerHTML='';DATA.ods.forEach(o=>{const d=document.createElement('div');d.className='option';d.innerHTML=`<div><strong>${o.title}</strong></div><small>${o.desc}</small><div style="margin-top:6px;font-weight:700;color:#0b5fb1">+${o.points}</div>`;d.onclick=()=>selectODS(o.id);l.appendChild(d);});show('ods');}function selectODS(id){const o=DATA.ods.find(x=>x.id===id);state.current.ods=o;beep(800,0.1);state.rounds.push({biome:state.current.biome,problem:state.current.problem,ods:o});state.total+=o.points;state.remaining=state.remaining.filter(x=>x!==state.current.biome.id);$('#choice-summary').innerHTML=`${state.current.biome.name} → ${state.current.problem.name}<br>Você escolheu <strong>${o.title}</strong>`;$('#round-score').textContent=o.points;$('#total-score').textContent=state.total;updateProgress();show('result');}function nextBiome(){if(state.remaining.length>0){renderMap();show('biome');}else showFinal();}function updateProgress(){const total=DATA.biomes.length;const done=total-state.remaining.length;const pct=(done/total)*100;$('#progress-bar').style.width=pct+'%';}function showFinal(){const max=DATA.biomes.length*40;const pct=(state.total/max)*100;let msg=pct>80?'Excelente! 🌟':'Bom trabalho! Continue aprendendo 🌿';const resumo=state.rounds.map(r=>`• ${r.biome.name} — ${r.problem.name} → ${r.ods.title} (+${r.ods.points})`).join('<br>');$('#final-score').textContent=state.total;$('#final-text').innerHTML=msg+'<br><br><strong>Resumo:</strong><br>'+resumo;show('final');}document.addEventListener('DOMContentLoaded',()=>{show('start');$('#start-btn').onclick=()=>{beep(520,0.05);init();};$('#biome-back').onclick=()=>show('start');$('#problem-back').onclick=()=>show('biome');$('#ods-back').onclick=()=>show('problem');$('#next-biome').onclick=()=>nextBiome();$('#play-again').onclick=()=>init();});